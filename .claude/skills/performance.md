# Performance

## 概要

パフォーマンス最適化のガイドライン。プロファイリングによるボトルネック特定、キャッシュ戦略、遅延読み込み、バンドルサイズ最適化を通じて、アプリケーションの応答性とスループットを改善する。

## 適用場面

- アプリケーションの応答速度が低下した場合
- スケーラビリティ要件への対応
- ユーザー体験の改善
- インフラコストの削減

## ベストプラクティス

### 1. プロファイリング

- 推測ではなく計測に基づいて最適化する
- Node.js: `--inspect` フラグとChrome DevToolsでCPUプロファイリング
- メモリ: ヒープスナップショットでメモリリークを検出する
- I/O: 非同期処理のボトルネックを `async_hooks` で追跡する
- ベンチマーク: `benchmark.js` や `vitest bench` で定量的に比較する

### 2. ボトルネック特定

- Amdahlの法則: 最も遅い部分の改善が全体に最も効果がある
- N+1問題: データベースクエリのバッチ化・プリロードで解決する
- 同期処理のブロッキング: 重い処理はWorker Threadsに委譲する
- ネットワーク: リクエスト数の削減とペイロードの圧縮を行う
- 正規表現: ReDoS (Regular Expression Denial of Service) に注意する

### 3. キャッシュ戦略

- 適切なキャッシュレイヤーを選択する（メモリ, Redis, CDN）
- キャッシュのTTL（有効期限）を適切に設定する
- キャッシュの無効化戦略を事前に設計する
- Cache-Aside パターン: アプリケーションがキャッシュの読み書きを制御する
- Write-Through パターン: 書き込み時にキャッシュも更新する

### 4. 遅延読み込みと最適化

- Dynamic import (`import()`) でコード分割する
- 使用していないモジュールの遅延読み込みを実装する
- Tree shakingが効くようにESModulesで記述する
- 画像・メディアの遅延読み込みを実装する
- バンドルアナライザーで不要な依存関係を特定する

### 5. バンドルサイズ管理

- `bundlephobia` でライブラリのサイズを事前確認する
- バンドルサイズの上限をCIで監視する（size-limit等）
- polyfillは必要最小限に抑える
- moment.js等の大きなライブラリは軽量な代替を検討する
- ソースマップは本番環境では分離する

## チェックリスト

- [ ] パフォーマンス目標（応答時間、スループット）が定義されている
- [ ] プロファイリングでボトルネックが特定されている
- [ ] キャッシュ戦略が適切に実装されている
- [ ] N+1問題が解消されている
- [ ] バンドルサイズが目標値以内に収まっている
- [ ] パフォーマンステストがCIに組み込まれている

## 関連スキル

- [デバッグ](./debugging.md)
- [CI/CD](./ci-cd.md)
- [TypeScript開発](./typescript-development.md)
