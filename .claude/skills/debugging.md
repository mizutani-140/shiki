# Debugging

## 概要

体系的なデバッグ手法とトラブルシューティングのガイドライン。問題の再現、原因の特定、修正の検証までを効率的に進めるための方法論を提供する。バイセクト、ログ分析、根本原因分析 (RCA) を活用する。

## 適用場面

- バグレポートの調査開始時
- 本番環境の障害対応
- テスト失敗の原因調査
- パフォーマンス劣化の原因追跡

## ベストプラクティス

### 1. 再現手順の確立

- バグレポートから最小再現手順 (Minimal Reproduction) を特定する
- 環境変数、OS、Node.jsバージョンなどの環境情報を記録する
- 再現が不安定な場合、条件を一つずつ固定して再現率を上げる
- 再現手順をテストコードとして記述する（修正後のリグレッションテストになる）

### 2. バイセクトによる原因特定

- `git bisect` を活用して問題が混入したコミットを特定する
- 自動テストと組み合わせて `git bisect run` で効率化する
- 設定変更を二分探索で切り分ける（設定値を半分ずつ変更）
- 依存ライブラリのバージョンを二分探索で特定する

### 3. ログとトレース

- 構造化ログ（JSON形式）を使い、検索・フィルタを容易にする
- ログレベルを適切に使い分ける（ERROR > WARN > INFO > DEBUG）
- リクエストIDやトレースIDでログを関連付ける
- 一時的なデバッグログは必ずコミット前に削除する
- `console.log` ではなく専用のloggerを使用する

### 4. 根本原因分析 (RCA)

- 「なぜなぜ分析」で5回「なぜ」を問い、根本原因に到達する
- 表面的な症状への対処療法ではなく、根本原因を修正する
- タイムラインを作成して、問題発生の経緯を整理する
- 類似問題の再発防止策を検討し、ドキュメントに記録する

### 5. 修正と検証

- 修正前にテストを書き、修正が正しいことを証明する
- 修正は最小限の変更に留める。関連しないリファクタリングは別PRにする
- 修正後、関連する既存テストが全てパスすることを確認する
- 本番環境でのモニタリングを強化し、再発しないことを確認する

## チェックリスト

- [ ] 最小再現手順が確立されている
- [ ] 問題を再現するテストが書かれている
- [ ] 根本原因が特定されている（表面的な症状ではなく）
- [ ] 修正は最小限の変更に留まっている
- [ ] リグレッションテストが追加されている
- [ ] 関連するドキュメントが更新されている

## 関連スキル

- [テスト駆動開発](./tdd-workflow.md)
- [パフォーマンス](./performance.md)
- [コードレビュー](./code-review.md)
