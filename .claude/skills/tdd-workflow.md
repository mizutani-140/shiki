# TDD Workflow

## 概要

テスト駆動開発 (Test-Driven Development) のワークフローガイド。Red-Green-Refactorサイクルに基づく開発プロセス、Vitest/Jestを用いたテストパターン、カバレッジ目標の設定を通じて、信頼性の高いコードを効率的に開発する。

## 適用場面

- 新機能の実装開始時
- バグ修正時（リグレッションテストの追加）
- リファクタリング前の安全ネット構築
- API設計のフィードバックループ

## ベストプラクティス

### 1. Red-Green-Refactorサイクル

- Red: 失敗するテストを最初に書く。テストが正しく失敗することを確認する
- Green: テストを通す最小限のコードを書く。完璧さよりも動作を優先する
- Refactor: テストが通った状態でコードを整理する。テストは常にグリーンを維持する
- サイクルは5-10分を目安に短く保つ

### 2. テスト設計

- Arrange-Act-Assert (AAA) パターンに従う
- テスト名は「何が」「どんな条件で」「どうなるか」を含める
- 1テスト1アサーションを原則とする（関連する複数アサーションは許容）
- テストの独立性を保つ。テスト間の順序依存を排除する
- テストデータはファクトリ関数で生成する

### 3. テストの種類と比率

- ユニットテスト: 70% - 個々の関数・クラスの動作検証
- 統合テスト: 20% - モジュール間の連携検証
- E2Eテスト: 10% - ユーザーシナリオの検証
- テストピラミッドを意識した構成にする

### 4. Vitest/Jest パターン

- `describe` でテスト対象を、`it` で振る舞いをグループ化する
- `beforeEach` / `afterEach` でセットアップ・クリーンアップを行う
- モックは最小限に留める。外部依存のみモックする
- `vi.fn()` / `jest.fn()` でスパイ・スタブを作成する
- スナップショットテストは意図的な変更の検出に限定する

### 5. カバレッジ管理

- 行カバレッジ: 80%以上を目標とする
- ブランチカバレッジ: 75%以上を目標とする
- カバレッジ100%を目的化しない。意味のあるテストを優先する
- カバレッジレポートをCIで自動生成し、PRにコメントする

## チェックリスト

- [ ] テストを先に書いてから実装している
- [ ] テストが失敗することを確認してから実装に入っている
- [ ] AAAパターンに従っている
- [ ] テスト名が振る舞いを説明している
- [ ] モックの使用が最小限に抑えられている
- [ ] エッジケース（境界値、null、空配列等）をテストしている
- [ ] カバレッジ目標を満たしている
- [ ] CIでテストが自動実行される

## 関連スキル

- [TypeScript開発](./typescript-development.md)
- [デバッグ](./debugging.md)
- [CI/CD](./ci-cd.md)
