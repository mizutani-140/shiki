# Security Audit

## 概要

セキュリティ監査のガイドライン。OWASP Top 10に基づく脆弱性チェック、依存関係のスキャン、シークレット検出、CVSS評価を通じて、アプリケーションのセキュリティレベルを体系的に評価・改善する。

## 適用場面

- 新機能リリース前のセキュリティレビュー
- 定期的なセキュリティ監査
- 依存ライブラリの脆弱性対応
- インシデント発生後の調査と再発防止

## ベストプラクティス

### 1. OWASP Top 10 チェック

- A01 アクセス制御の不備: 全エンドポイントで認証・認可を検証する
- A02 暗号化の失敗: 機密データの暗号化と安全な鍵管理を確認する
- A03 インジェクション: SQL, NoSQL, OS, LDAPインジェクション対策を確認する
- A04 安全でない設計: 脅威モデリングを実施する
- A05 セキュリティ設定ミス: デフォルト設定、不要な機能の無効化を確認する
- A07 認証の不備: パスワードポリシー、MFA、セッション管理を確認する
- A09 ログとモニタリングの不足: セキュリティイベントの記録を確認する

### 2. 依存関係スキャン

- `npm audit` を定期的に実行する
- Snyk, Dependabot, Socket等のツールを導入する
- Critical/Highの脆弱性は即座に対応する
- 使用していない依存関係を削除する
- lockファイルをコミットし、再現可能なビルドを保証する

### 3. シークレット検出

- `.env` ファイルをGitの管理対象外にする（.gitignore）
- git-secrets, gitleaks, truffleHog等でコミット履歴をスキャンする
- CIパイプラインにシークレットスキャンを組み込む
- シークレットがコミットされた場合は即座にローテーションする
- 環境変数またはシークレットマネージャーで管理する

### 4. CVSS評価と優先度付け

- 脆弱性をCVSS v3/v4で評価する
- 攻撃の容易さ (Attack Complexity) と影響度 (Impact) を考慮する
- CVSS 9.0以上: 即座に対応（24時間以内）
- CVSS 7.0-8.9: 1週間以内に対応
- CVSS 4.0-6.9: 次のスプリントで対応
- CVSS 0.1-3.9: バックログに追加

### 5. セキュアコーディング

- 入力値は全てバリデーションする（ホワイトリスト方式）
- 出力はコンテキストに応じてエスケープする
- 最小権限の原則に従う
- エラーメッセージに内部情報を含めない
- セキュリティヘッダーを適切に設定する

## チェックリスト

- [ ] OWASP Top 10の各項目を確認した
- [ ] `npm audit` で既知の脆弱性がない
- [ ] シークレットがコードにハードコードされていない
- [ ] 入力バリデーションが全エンドポイントに実装されている
- [ ] 認証・認可が正しく実装されている
- [ ] セキュリティヘッダーが設定されている
- [ ] ログにセキュリティイベントが記録されている

## 関連スキル

- [コードレビュー](./code-review.md)
- [CI/CD](./ci-cd.md)
- [MCP Server開発](./mcp-server-development.md)
